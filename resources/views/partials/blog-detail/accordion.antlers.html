<section
  x-data="accordionComponent()"
  x-init="calculateHeights()"
  class="bg-white shadow-lg rounded-lg p-6"
  data-aos="fade-up"
  data-aos-duration="800"
  data-aos-easing="ease-in-out"
>
  <h2 class="text-xl font-semibold text-gray-900 border-b border-gray-300 pb-3 mb-6">
    Additional Information
  </h2>

  <template x-for="(item, index) in accordionItems" :key="index">
    <div
      class="mb-4 rounded-md shadow-sm overflow-hidden border border-gray-200"
      :class="openIndex === index ? 'bg-purple-50 border-purple-300' : 'bg-white'"
      data-aos="fade"
      data-aos-delay="100"
      data-aos-duration="600"
    >
      <button
        @click="toggle(index)"
        class="flex items-center justify-between w-full px-5 py-4 font-semibold text-purple-800
               focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors
               hover:bg-purple-100 rounded-md"
        :aria-expanded="openIndex === index"
        :class="{ 'rounded-b-none': openIndex === index }"
      >
        <span x-text="item.accordion_title" class="text-lg"></span>
        <svg xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6 transform transition-transform duration-300"
          :class="openIndex === index ? 'rotate-180 text-purple-600' : 'rotate-0 text-purple-900'"
          fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
        >
          <path x-show="openIndex === index" stroke-linecap="round" stroke-linejoin="round" d="M20 12H4"/>
          <path x-show="openIndex !== index" stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
        </svg>
      </button>

      <div
        x-ref="el => refs[index] = el"
        class="px-5 overflow-hidden"
        x-bind:style="openIndex === index ? `max-height: ${refs[index]?.scrollHeight}px` : 'max-height: 0px'"
        x-transition:enter="transition-all duration-700 ease-in-out"
        x-transition:leave="transition-all duration-700 ease-in-out"
      >
        <div
          class="py-4 text-gray-700 text-base leading-relaxed transition-opacity transform duration-500"
          x-show="openIndex === index"
          x-transition:enter="opacity-0 -translate-y-2"
          x-transition:enter-start="opacity-0 -translate-y-2"
          x-transition:enter-end="opacity-100 translate-y-0"
          x-transition:leave="opacity-100 translate-y-0"
          x-transition:leave-start="opacity-100 translate-y-0"
          x-transition:leave-end="opacity-0 -translate-y-2"
          style="display: none;"
        >
          <span x-text="item.accordion_content"></span>
        </div>
      </div>
    </div>
  </template>
</section>

<script>
  function accordionComponent() {
    return {
      openIndex: null,
      refs: [],
      accordionItems: {{ accordions | json }},
      toggle(index) {
        this.openIndex = this.openIndex === index ? null : index;
        this.$nextTick(() => {
          // Recalculate max-heights on toggle for smooth transitions
          this.refs = this.$el.querySelectorAll('[x-ref]');
        });
      },
      calculateHeights() {
        this.$nextTick(() => {
          this.refs = this.$el.querySelectorAll('[x-ref]');
        });
      },
    };
  }
</script>
